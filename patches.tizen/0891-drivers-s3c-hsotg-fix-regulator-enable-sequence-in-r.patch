From af278acad4835d0f7c93579d3bda6e9e44454410 Mon Sep 17 00:00:00 2001
From: Marek Szyprowski <m.szyprowski@samsung.com>
Date: Fri, 25 Oct 2013 11:24:21 +0200
Subject: [PATCH 0891/1302] drivers: s3c-hsotg: fix regulator enable sequence
 in resume callback

Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
Signed-off-by: MyungJoo Ham <myungjoo.ham@samsung.com>
---
 drivers/usb/gadget/s3c-hsotg.c | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/drivers/usb/gadget/s3c-hsotg.c b/drivers/usb/gadget/s3c-hsotg.c
index 55c6f92..333a647 100644
--- a/drivers/usb/gadget/s3c-hsotg.c
+++ b/drivers/usb/gadget/s3c-hsotg.c
@@ -3709,8 +3709,11 @@ static int s3c_hsotg_resume(struct platform_device *pdev)
 	unsigned long flags;
 	int ret = 0;
 
-	if (hsotg->driver)
+	if (hsotg->driver) {
 		dev_info(hsotg->dev, "resuming usb gadget %s\n", hsotg->driver->driver.name);
+		ret = regulator_bulk_enable(ARRAY_SIZE(hsotg->supplies),
+				      hsotg->supplies);
+	}
 
 	spin_lock_irqsave(&hsotg->lock, flags);
 	hsotg->last_rst = jiffies;
@@ -3718,10 +3721,6 @@ static int s3c_hsotg_resume(struct platform_device *pdev)
 	s3c_hsotg_core_init(hsotg);
 	spin_unlock_irqrestore(&hsotg->lock, flags);
 
-	if (hsotg->driver)
-		ret = regulator_bulk_enable(ARRAY_SIZE(hsotg->supplies),
-				      hsotg->supplies);
-
 	return ret;
 }
 
-- 
1.8.3.2

